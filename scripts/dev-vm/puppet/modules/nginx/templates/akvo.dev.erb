upstream rsr {
    server 127.0.0.1:1337 fail_timeout=0;
}

# Normal RSR
server {
  listen 80;
  server_name akvo.org akvo.dev;

  # access_log logs/akvo.access.log;
  # error_log logs/akvo.error.log;

  #location /rsr/static {
  #  alias /var/www/akvo/static;
  #}

  location /rsr/media {
    alias /var/akvo/akvo/mediaroot;
  }

  location / {
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;

      if (!-f $request_filename) {
        proxy_pass http://rsr;
        break;
      }
  }
}

# Partner sites
server {
  listen 80 default;

  # access_log logs/akvoapp.access.log;
  # error_log logs/akvoapp.error.log;

  #location /rsr/static {
  #  alias /var/www/akvo/static;
  #}

  location /rsr/media {
  	alias /var/akvo/akvo/mediaroot;
  }

  location / {
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;

      if (!-f $request_filename) {
        proxy_pass http://rsr;
        break;
      }
  }
}